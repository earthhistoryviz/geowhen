(this.webpackJsonpgeowhen=this.webpackJsonpgeowhen||[]).push([[0],{100:function(e,t){},104:function(e,t,r){"use strict";r.r(t);var a={};r.r(a),r.d(a,"onInitializeOvermind",(function(){return A})),r.d(a,"doFilter",(function(){return F})),r.d(a,"mergeFilter",(function(){return I})),r.d(a,"mergeStagingFilter",(function(){return B})),r.d(a,"applyFilters",(function(){return N})),r.d(a,"resetFilters",(function(){return R})),r.d(a,"toggleFilterModal",(function(){return k})),r.d(a,"selectItem",(function(){return T})),r.d(a,"showStageModal",(function(){return G})),r.d(a,"stageUrlChanged",(function(){return M})),r.d(a,"clearUrl",(function(){return E}));var o={};r.r(o),r.d(o,"router",(function(){return P}));var i=r(1),s=r.n(i),n=r(20),l=r.n(n),c=r(33),d=(r(75),r(76),r(26)),g=r(109),p=r(58),b=r(107),j=r(108),x=r(64),u=r(106),h=r(63),m=r(21),f=r(2),v=r(25),O=r.n(v),y=r(44),C=r(45),w=r.n(C),S=r(35),D=r.n(S),A=function(){var e=Object(y.a)(O.a.mark((function e(t){var r,a,o,i,s,n,l,c,d,g,p,b;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.state,a=t.actions,o=t.effects,r.isLoading=!0,o.router.initialize({"/stage/:stageName":a.stageUrlChanged,"":a.clearUrl}),e.next=5,w.a.get("https://api.github.com/repos/earthhistoryviz/geowhen/contents/data/MasterData.xlsx",{headers:{Accept:"application/vnd.github.v3.raw"},responseType:"arraybuffer"});case 5:return i=e.sent,s=D.a.read(new Uint8Array(i.data),{type:"array"}),console.log("spreadsheet = ",s),n=D.a.utils.sheet_to_json(s.Sheets["Geological stages"]).slice(1),l=n.reduce((function(e,t){return e[t.Period]||(e[t.Period]=[]),e[t.Period].push(t),e}),{}),c=n.reduce((function(e,t){return e.periods.add(t.Period),t.Region&&" "!==t.Region&&e.regions.add(t.Region),e}),{periods:new Set,regions:new Set}),console.log("byperiod = ",l),r.masterdata.byperiod=l,r.masterdata.displayedStages=l,r.view.filterOptions.periods=Array.from(c.periods),r.view.filterOptions.regions=Array.from(c.regions),e.next=18,w.a.get("https://api.github.com/repos/earthhistoryviz/geowhen/contents/data/default_timescale.xlsx",{headers:{Accept:"application/vnd.github.v3.raw"},responseType:"arraybuffer"});case 18:d=e.sent,g=D.a.read(new Uint8Array(d.data),{type:"array"}),p=D.a.utils.sheet_to_json(g.Sheets.MasterChronostrat).slice(1),console.log(p),b=p.map((function(e){var t=e["Color (internat)"].split("/");return{topAge:e.Ma,color:"rgb("+t.join(", ")+")"}})),console.log(b),r.view.stageColors=b,r.isLoading=!1,r.page.stageName&&(console.log("Re-calling stageUrlChanged after initialization"),a.stageUrlChanged(r.page));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(e){var t=e.state,r={},a=t.filter;Object.keys(t.masterdata.byperiod).forEach((function(e){var o=t.masterdata.byperiod[e];r[e]=o.filter((function(e){return e.STAGE.toUpperCase().includes(a.queryStr.toUpperCase())?(console.log("region type is: ",typeof e.Region),!a.region||"string"===typeof e.Region&&e.Region.toUpperCase().includes(a.region.toUpperCase())?!(a.period&&("string"!==typeof e.Period||!e.Period.toUpperCase().includes(a.period.toUpperCase())))&&!(a.topAge&&a.bottomAge&&(e.Base<parseFloat(a.topAge)||e.TOP>parseFloat(a.bottomAge))):(console.log("filter region denies inclusion of "+e.STAGE),!1)):(console.log("query string denies inclusion of "+e.STAGE),!1)})),"alphabet"===a.sortBy?r[e].sort((function(e,t){return e.STAGE<t.STAGE?-1:e.STAGE>t.STAGE?1:0})):"age"===a.sortBy?r[e].sort((function(e,t){return e.Base<t.Base?-1:e.Base>t.Base?1:0})):a.sortBy})),t.masterdata.displayedStages=r},I=function(e,t){var r=e.state,a=e.actions;r.filter=Object(f.a)(Object(f.a)({},r.filter),t),a.doFilter(),console.log(r.filter)},B=function(e,t){var r=e.state;r.view.filterModal.stagingFilter=Object(f.a)(Object(f.a)({},r.view.filterModal.stagingFilter),t)},N=function(e){var t=e.state,r=e.actions,a=t.view.filterModal.stagingFilter;t.view.filterModal.visible=!t.view.filterModal.visible,a.bottomAge&&!a.topAge&&(a.topAge=a.bottomAge),t.filter=Object(f.a)({},a),r.doFilter()},R=function(e){e.state.view.filterModal.stagingFilter={period:!1,region:!1,topAge:!1,bottomAge:!1,sortBy:!1,queryStr:""}},k=function(e){var t=e.state;t.view.filterModal.visible||(t.view.filterModal.stagingFilter=Object(f.a)({},t.filter)),t.view.filterModal.visible=!t.view.filterModal.visible},T=function(e,t){var r=e.state,a=e.effects;r.selectedItem=!1!==t&&Object(f.a)({},t),a.router.navigateTo("/stage/"+t.STAGE)},G=function(){var e=Object(y.a)(O.a.mark((function e(t,r){var a,o,i,s,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.state,t.effects,o=t.actions,i=r.stageName,s=a.masterdata.byperiod,n=null,Object.keys(s).forEach((function(e){s[e].forEach((function(e){e.STAGE===i&&(console.log("Found selectedStage = ",e),n=e)}))})),o.selectItem(n);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),M=function(e,t){var r=e.state,a=e.actions,o=t.stageName;if(r.page.stageName=!!o&&o.toUpperCase(),r.masterdata&&r.masterdata.displayedStages){var i=!1;for(var s in r.masterdata.displayedStages){var n=r.masterdata.displayedStages[s];for(var l in n){var c=n[l].STAGE||"";if(c.toUpperCase().replace(/ /g,"")===o){i=c;break}}if(i)break}i?r.selectedItem&&r.selectedItem.STAGE===i?console.log("Stage ",i," is already the selected stage."):a.showStageModal({stageName:i}):console.log("WARNING: stage ",o," requested, but no stage could be found for that name")}else console.log("WARNING: trying to set page URL BEFORE displayedStages are available")},E=function(e){e.state.page.stageName=!1},U=r(30),L=r.n(U),P={initialize:function(e){console.log("Initializing router with routes: ",e),Object.keys(e).forEach((function(t){L()(t,(function(r){var a=r.params;return e[t](a)}))})),L.a.base("/geowhen"),L.a.start()},navigateTo:function(e){console.log("Navigating to: ",e),e.match("undefined")?L.a.show("/"):L.a.show(e)}},W=Object(m.d)({state:{isLoading:!0,selectedItem:!1,page:{stageName:!1},masterdata:{byperiod:{},displayedStages:{},raw:[]},filter:{period:!1,region:!1,topAge:!1,bottomAge:!1,sortBy:!1,queryStr:""},view:{filterModal:{visible:!1,stagingFilter:{}},filterOptions:{periods:[],regions:[]},stageColors:{}}},actions:a,effects:o}),z=Object(c.c)(),q=Object(c.b)(),H=r(0),_=function(e){var t=q(),r=z(),a=r.view.filterModal,o=r.view.filterOptions,i=a.stagingFilter,s=function(){return t.toggleFilterModal()};return Object(H.jsxs)(H.Fragment,{children:[Object(H.jsxs)(g.a,{className:"my-3",size:"lg",children:[Object(H.jsx)(p.a,{onChange:e.onChange,"aria-label":"Large","aria-describedby":"inputGroup-sizing-sm",placeholder:"Search"}),Object(H.jsx)(d.a,{variant:"primary",onClick:function(){return t.toggleFilterModal()},children:"Filter menu"}),Object(H.jsxs)(b.a,{size:"lg",show:a.visible,onHide:s,children:[Object(H.jsx)(b.a.Header,{closeButton:!0,children:Object(H.jsx)(b.a.Title,{children:"Advance Filtering Menu"})}),Object(H.jsx)(b.a.Body,{className:"p-sm-5",children:Object(H.jsxs)(j.a,{children:[Object(H.jsx)("h5",{children:"Search by:"}),Object(H.jsx)(x.a,{className:"my-2",controlId:"floatingSelect",label:"By Period",children:Object(H.jsxs)(j.a.Select,{onChange:function(e){return t.mergeStagingFilter({period:e.target.value})},"aria-label":"Floating label select example",children:[Object(H.jsx)("option",{value:"",selected:!i.period,children:"All"}),o.periods.map((function(e,t){return Object(H.jsx)("option",{value:e,selected:e===i.period,children:e},t)}))]})}),Object(H.jsx)(x.a,{className:"my-2",controlId:"floatingSelect",label:"By Region",children:Object(H.jsxs)(j.a.Select,{onChange:function(e){return t.mergeStagingFilter({region:e.target.value})},"aria-label":"Floating label select example",children:[Object(H.jsx)("option",{value:"",selected:!i.region,children:"All"}),o.regions.map((function(e,t){return Object(H.jsx)("option",{value:e,selected:e===i.region,children:e},t)}))]})}),Object(H.jsxs)(j.a.Group,{as:u.a,className:"mb-3",children:[Object(H.jsx)(j.a.Label,{column:!0,sm:"2",children:"By Age:"}),Object(H.jsx)(h.a,{sm:"4",children:Object(H.jsx)(j.a.Control,{type:"number",placeholder:"Lower Bound",onChange:function(e){t.mergeStagingFilter({bottomAge:e.target.value})},value:i.bottomAge})}),Object(H.jsx)(h.a,{className:"d-flex justify-content-center",sm:"2",children:Object(H.jsx)("p",{className:"m-auto",children:"to"})}),Object(H.jsx)(h.a,{sm:"4",children:Object(H.jsx)(j.a.Control,{type:"number",placeholder:"Upper Bound",onChange:function(e){t.mergeStagingFilter({topAge:e.target.value})},value:i.topAge})})]}),Object(H.jsx)("hr",{}),Object(H.jsx)("h5",{children:"Sort by:"}),Object(H.jsxs)(j.a.Group,{className:"mb-3",onChange:function(e){t.mergeStagingFilter({sortBy:e.target.value})},children:[Object(H.jsx)(j.a.Check,{type:"radio",name:"sortBy",label:"sort-alphabetically",value:"alphabet",checked:"alphabet"===i.sortBy}),Object(H.jsx)(j.a.Check,{type:"radio",name:"sortBy",label:"sort-by-age",value:"age",checked:"age"===i.sortBy}),Object(H.jsx)(j.a.Check,{type:"radio",name:"sortBy",label:"sort-by-region (coming soon)",value:"region",checked:"region"===i.sortBy})]}),Object(H.jsx)("hr",{}),Object(H.jsx)("h5",{children:"Group by:"})]})}),Object(H.jsxs)(b.a.Footer,{children:[Object(H.jsx)(d.a,{variant:"secondary",onClick:s,children:"Close"}),Object(H.jsx)(d.a,{variant:"danger",onClick:t.resetFilters,children:"Reset"}),Object(H.jsx)(d.a,{variant:"primary",onClick:function(){return t.applyFilters()},children:"Apply"})]})]})]}),Object(H.jsx)("p",{})]})},X=function(){var e=z(),t=q(),r=function(){t.selectItem(!1)},a=!1;return e.selectedItem&&(function(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!==t.status}(a="/geowhen/stage-charts/".concat(e.selectedItem.Period.toUpperCase(),"_regional.jpg"))||(a=!1)),console.log(e.selectedItem),Object(H.jsxs)(b.a,{show:!1!==e.selectedItem,onHide:r,size:"xl",style:{padding:"0px"},children:[Object(H.jsx)(b.a.Header,{closeButton:!0,children:Object(H.jsxs)(b.a.Title,{children:["Stage Information - ",e.selectedItem.STAGE]})}),Object(H.jsx)(b.a.Body,{className:"p-sm-5",children:e.selectedItem?Object(H.jsxs)("div",{className:"border shadow-sm mb-4 pb-4 pt-2",style:{border:"20px solid ",borderRadius:"10px"},children:[Object(H.jsxs)("div",{className:"w-100",align:"center",children:[Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{children:Object(H.jsx)("h3",{children:e.selectedItem.STAGE})}),Object(H.jsxs)("div",{style:{fontWeight:"normal"},children:["(Period: ",e.selectedItem.Period,")"]})]}),e.selectedItem.Rank?Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Rank:"}),Object(H.jsx)("div",{children:e.selectedItem.Rank})]}):"",Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Region:"}),Object(H.jsx)("div",{children:e.selectedItem.Region})]}),Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Top Age:"}),Object(H.jsx)("div",{children:+e.selectedItem.TOP.toFixed(3)})]}),Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Base Age:"}),Object(H.jsx)("div",{children:+e.selectedItem.Base.toFixed(3)})]}),e.selectedItem.Comments?Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Comments:"}),Object(H.jsx)("div",{children:e.selectedItem.Comments})]}):"",Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Top Calibration:"}),Object(H.jsx)("div",{children:e.selectedItem["Top calibration"]})]}),Object(H.jsxs)("div",{style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("div",{style:{fontWeight:"bold"},children:"Base Calibration:"}),Object(H.jsx)("div",{children:e.selectedItem["Base calibration"]})]})]}),Object(H.jsx)("div",{className:"d-flex justify-content-center",style:{overflow:"scroll"},children:a?Object(H.jsx)("img",{className:"m-auto",src:a,alt:"Stage Chart"}):""})]}):""}),Object(H.jsx)(b.a.Footer,{children:Object(H.jsx)(d.a,{variant:"secondary",onClick:r,children:"Close"})})]})};window.processGithubResponse||(window.processGithubResponse=function(e){console.log("Callback was called w/ data: ",e)});var J=function(){var e=z(),t=q(),r=e.view.stageColors,a=e.isLoading,o=e.masterdata;return e.selectedItem&&(function(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!==t.status}("/geowhen/stage-charts/".concat(e.selectedItem.Period.toUpperCase(),"_regional.jpg"))||!1),Object(H.jsxs)("div",{className:"mx-auto mt-4",style:{width:"90%"},children:[Object(H.jsxs)("div",{className:"mx-auto mt-4",children:[Object(H.jsx)("div",{children:Object(H.jsx)("img",{src:"/geowhen/geowhen_logo.png",height:"75px",alt:"GeoWhen Logo"})}),Object(H.jsxs)("div",{children:["Lookup table for regional stages provided by",Object(H.jsx)("br",{}),Object(H.jsx)("a",{href:"https://ccgm.org/en/",children:"Commission for the Geological Map of the World (UNESCO)"})]})]}),a?Object(H.jsx)("p",{children:"Loading..."}):Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)(_,{onChange:function(e){t.mergeFilter({queryStr:e.target.value})}}),Object(H.jsxs)("div",{children:[Object(H.jsx)("b",{children:"Click"})," on a stage below for details, ",Object(H.jsx)("b",{children:"Search"})," by portion of name, or ",Object(H.jsx)("b",{children:"Filter"})," by region or geologic or numerical age.",Object(H.jsx)("br",{}),"Scroll down for more stages, scroll right for more periods."]}),Object(H.jsx)("div",{className:"mt-5 border shadow-sm",style:{height:"400px",overflowX:"scroll",marginTop:"5px !important"},children:Object(H.jsx)("div",{className:"scrolling-wrapper row flex-row flex-nowrap mt-4 pb-4 pt-2",children:Object.keys(o.displayedStages).map((function(e,a){return o.displayedStages[e]&&o.displayedStages[e].length<1?"":Object(H.jsxs)("div",{className:"col",align:"center",style:{border:"1px solid #DDDDDD",borderRadius:"3px",boxShadow:"3px 3px #CCCCC",margin:"5px 5px 5px 5px"},children:[Object(H.jsx)("strong",{children:e}),o.displayedStages[e].map((function(e,a){for(var o=r[0].color,i=0;i<r.length&&e.Base>r[i].topAge;i++)o=r[i+1].color;return Object(H.jsx)("div",{className:"my-2 col-8 d-flex justify-content-center",children:Object(H.jsx)(d.a,{style:{backgroundColor:o,color:"black"},onClick:function(){t.selectItem(e)},children:e.STAGE})},a)}))]},a)}))})}),Object(H.jsx)(X,{})]})]})};console.log=function(){},l.a.render(Object(H.jsx)(c.a,{value:W,children:Object(H.jsx)(s.a.StrictMode,{children:Object(H.jsx)(J,{})})}),document.getElementById("root"))},55:function(e,t){},75:function(e,t,r){},99:function(e,t){}},[[104,1,2]]]);
//# sourceMappingURL=main.37df4292.chunk.js.map